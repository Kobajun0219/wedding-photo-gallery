# デプロイ前チェックリスト

## バックエンド（APIサーバー）の準備

### 1. 環境変数の設定
- [ ] `AWS_REGION` が設定されている（デフォルト: `ap-northeast-1`）
- [ ] `AWS_ACCESS_KEY_ID` が設定されている
- [ ] `AWS_SECRET_ACCESS_KEY` が設定されている
- [ ] `S3_BUCKET_NAME` が設定されている
- [ ] `PORT` が設定されている（デフォルト: 3002）
- [ ] `FRONTEND_URL` が設定されている（本番環境のフロントエンドURL）

### 1-1. AWS IAM権限の確認
- [ ] S3への読み取り権限（`s3:ListBucket`, `s3:GetObject`）
- [ ] DynamoDBへの読み取り権限（`dynamodb:Scan`）
- [ ] DynamoDBへの書き込み権限（LINE経由で投稿する場合、`dynamodb:PutItem`）

### 2. CORS設定の確認
- [ ] `server/index.js` のCORS設定に本番環境のURLが含まれている
- [ ] 開発環境のURLも含まれている（必要に応じて）

### 3. サーバーの動作確認
- [ ] ローカルでサーバーが起動する
- [ ] `/api/health` エンドポイントが動作する
- [ ] `/api/photos/random` エンドポイントが動作する
- [ ] S3から写真が取得できる
- [ ] `/api/comments` エンドポイントが動作する
- [ ] DynamoDBからコメントが取得できる

### 3-1. DynamoDBテーブルの確認
- [ ] `weddingComment`テーブルが存在する
- [ ] パーティションキーが`messageId` (String) に設定されている
- [ ] テーブルにテストデータがある（オプション）
- [ ] AWS認証情報にDynamoDBへのアクセス権限がある

---

## フロントエンドの準備

### 1. 環境変数の設定
- [ ] `VITE_API_BASE_URL` が本番環境のAPI URLに設定されている

### 2. ビルドの確認
- [ ] `npm run build` が成功する
- [ ] `dist` ディレクトリが生成される
- [ ] ビルド後のファイルが正しく動作する（`npm run preview`で確認）

### 3. API接続の確認
- [ ] フロントエンドがバックエンドAPIに接続できる
- [ ] CORSエラーが発生しない

---

## デプロイプラットフォーム別の確認

### Railway（バックエンド）
- [ ] Railwayアカウントが作成されている
- [ ] プロジェクトが作成されている
- [ ] 環境変数が設定されている
- [ ] デプロイが成功している
- [ ] APIのURLが確認できる

### Vercel（フロントエンド）
- [ ] Vercelアカウントが作成されている
- [ ] プロジェクトが作成されている
- [ ] 環境変数が設定されている
- [ ] ビルドが成功している
- [ ] フロントエンドのURLが確認できる

### Netlify（フロントエンド）
- [ ] Netlifyアカウントが作成されている
- [ ] プロジェクトが作成されている
- [ ] 環境変数が設定されている
- [ ] ビルドが成功している
- [ ] フロントエンドのURLが確認できる

### Render（バックエンド）
- [ ] Renderアカウントが作成されている
- [ ] Webサービスが作成されている
- [ ] 環境変数が設定されている
- [ ] デプロイが成功している
- [ ] APIのURLが確認できる

---

## デプロイ後の確認

### 1. 動作確認
- [ ] フロントエンドにアクセスできる
- [ ] 写真が表示される
- [ ] カルーセルが動作する
- [ ] 写真の自動更新が動作する（1分ごと）
- [ ] コメントが表示される
- [ ] コメントの自動更新が動作する（30秒ごと）
- [ ] エラーが発生しない

### 2. セキュリティ確認
- [ ] HTTPSが有効になっている
- [ ] CORSが正しく設定されている
- [ ] 環境変数が漏洩していない
- [ ] AWS認証情報がクライアント側に露出していない

### 3. パフォーマンス確認
- [ ] ページの読み込み速度が適切
- [ ] 写真の読み込みが正常
- [ ] サーバーのレスポンス時間が適切

---

## トラブルシューティング

### よくある問題

1. **CORSエラー**
   - バックエンドのCORS設定を確認
   - フロントエンドのURLが正しく設定されているか確認

2. **環境変数が読み込まれない**
   - プラットフォームの環境変数設定を確認
   - 環境変数の名前が正しいか確認
   - デプロイを再実行

3. **ビルドエラー**
   - ローカルでビルドが成功するか確認
   - ビルドログを確認
   - Node.jsのバージョンを確認

4. **APIに接続できない**
   - APIのURLが正しいか確認
   - フロントエンドの環境変数を確認
   - バックエンドが起動しているか確認

5. **コメントが表示されない**
   - DynamoDBテーブル`weddingComment`が存在するか確認
   - AWS認証情報にDynamoDBへの読み取り権限があるか確認
   - `/api/comments`エンドポイントが正常に動作するか確認
   - ブラウザのコンソールでエラーを確認
   - バックエンドのログを確認

---

## 次のステップ

デプロイが成功したら：

1. カスタムドメインの設定（オプション）
2. モニタリングの設定
3. ログの確認
4. パフォーマンスの最適化
